{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The role of the user.",
          "enum": [
            "athlete",
            "coach",
            "parent",
            "admin"
          ]
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "role",
        "firstName",
        "lastName"
      ]
    },
    "Athlete": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Athlete",
      "type": "object",
      "description": "Represents an athlete user, extending the base User entity.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Athlete entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 Athlete)"
        },
        "dateOfBirth": {
          "type": "string",
          "description": "Date of birth of the athlete.",
          "format": "date-time"
        },
        "parentUserIds": {
          "type": "array",
          "description": "References to Parents. (Relationship: Parent 1:N Athlete)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "dateOfBirth"
      ]
    },
    "Parent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Parent",
      "type": "object",
      "description": "Represents a parent user, extending the base User entity.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Parent entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 Parent)"
        },
        "athleteUserIds": {
          "type": "array",
          "description": "References to Athletes. (Relationship: Athlete 1:N Parent)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId"
      ]
    },
    "Event": {
      "title": "Event",
      "description": "Represents a team event, such as a practice or a meeting.",
      "type": "object",
      "properties": {
        "title": {
          "type": "string"
        },
        "status": {
          "type": "string",
          "enum": ["Completed", "Scheduled"]
        },
        "date": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": ["title", "status", "date"]
    },
    "Competition": {
      "title": "Competition",
      "description": "Represents a competitive event.",
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "date": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": ["name", "date"]
    },
    "TeamMember": {
      "title": "TeamMember",
      "description": "Represents an active team member.",
      "type": "object",
      "properties": {
        "userId": {
          "type": "string"
        },
        "joinDate": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": ["userId", "joinDate"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. The `userId` is the Firebase Authentication UID. This is private data.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user."
            }
          ]
        }
      },
      {
        "path": "/athletes/{athleteId}",
        "definition": {
          "entityName": "Athlete",
          "schema": {
            "$ref": "#/backend/entities/Athlete"
          },
          "description": "Stores athlete profiles. Includes the `userId` field for linking to the corresponding user document. Includes denormalized `parentUserIds` array.",
          "params": [
            {
              "name": "athleteId",
              "description": "The unique identifier of the athlete profile."
            }
          ]
        }
      },
      {
        "path": "/parents/{parentId}",
        "definition": {
          "entityName": "Parent",
          "schema": {
            "$ref": "#/backend/entities/Parent"
          },
          "description": "Stores parent profiles. Includes the `userId` field for linking to the corresponding user document. Includes denormalized `athleteUserIds` array.",
          "params": [
            {
              "name": "parentId",
              "description": "The unique identifier of the parent profile."
            }
          ]
        }
      },
      {
        "path": "/events/{eventId}",
        "definition": {
          "entityName": "Event",
          "schema": {
            "$ref": "#/backend/entities/Event"
          },
          "description": "Stores team events like practices and meetings.",
          "params": [
            {
              "name": "eventId",
              "description": "The unique identifier for the event."
            }
          ]
        }
      },
      {
        "path": "/competitions/{competitionId}",
        "definition": {
          "entityName": "Competition",
          "schema": {
            "$ref": "#/backend/entities/Competition"
          },
          "description": "Stores upcoming and past competitions.",
          "params": [
            {
              "name": "competitionId",
              "description": "The unique identifier for the competition."
            }
          ]
        }
      },
      {
        "path": "/teamMembers/{memberId}",
        "definition": {
          "entityName": "TeamMember",
          "schema": {
            "$ref": "#/backend/entities/TeamMember"
          },
          "description": "Stores active team members.",
          "params": [
            {
              "name": "memberId",
              "description": "The unique identifier for the team member, often the userId."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support the Demyanenko Team Hub application, focusing on user roles (athlete, parent), registration, and authentication. It prioritizes Authorization Independence, clarity, and scalability. User data is stored in the `/users/{userId}` collection, with separate collections for Athlete and Parent profiles linked to the user ID. This design uses path-based ownership for user-specific data and avoids `get()` calls in security rules, enhancing security and enabling atomic operations. The structure facilitates secure `list` operations and explicit state modeling, ensuring a robust and maintainable application. The addition of `events`, `competitions`, and `teamMembers` collections allows for dynamic data management for the dashboard and other sections of the app."
  }
}
